BwdNotes.txt
============
by Conrad Albrecht (CMA) 2013.07.29 - 2013.10.28

This document's purpose is to tell a new developer what he needs to know to take 
over the BAER Web Database (BWD) project at the Moscow Forestry Sciences
Laboratory.

Contents:
    .Dev_Files
        A guide to the files in the project on the development PC.

    .Server_Files
        A guide to the files on the Web server.

    .Using_a_New_DB
        About once a year, the EBAER Access database will be updated and the new
        version will need to be propagated into BWD.  This section tells how.

    .BAR_Files
        How to place Burned Area Report (2500-8) files on the server so our Web
        pages can offer them to the user.

    .Code
        About the project's source code, which runs on the Web server and
        generates our Web pages on the fly.


.Dev_Files
==========

This is the folder structure for this project on my development PC (other
folders in "my folder" on my PC are not part of this project):

[cma2]\
    CurrentEbaer\
    OutputsToForestWww\
    [ToBackup]\
        [BaerWebDb]\
            CopyToCgiBaerDb\
            CopyToHtdocsBaerDb\

The project should work on a new PC if the new location contains the above
structure and you copy the following files and subtrees to the new PC:
*   [BaerWebDb] (copy the entire subtree)

The names of the []'ed folders are just their names on my PC and should not need
to be the same on the new PC.  On my PC, [cma2] = C:\awae\cma2.

Descriptions of the files and folders follow.

[cma2]\CurrentEbaer\
    When you want to propagate a new version of the EBAER Access database to the
    Web site, you should copy the new EBAER Access file into this folder.  Then
    you will create the files Projects.xml, "Treatment Costs.xml", and
    Treatments.xml, also in this folder, by exporting tables from the Access
    file.  Then you will copy these files to the Web server (see .UsingANewDb).

[cma2]\OutputsToForestWww\
    This folder contains a subtree containing files generated by our development 
    process, which files should then by copied to corresponding locations on our
    Web server (see .BAR_Files).  [cma2]\OutputsToForestWww\ on
    the dev PC corresponds to the server node [forest]/srv/www/.

[cma2]\[ToBackup]\[BaerWebDb]\
    This folder contains all of the "source code" for this BWD project (see
    below).

[cma2]\[ToBackup]\[BaerWebDb]\BwdNotes.txt
    This file.

[cma2]\[ToBackup]\[BaerWebDb]\CopyToCgiBaerDb\
[cma2]\[ToBackup]\[BaerWebDb]\CopyToHtdocsBaerDb\
    These folders contain source code which is "built" and deployed by simply
    copying it to our Web server.  The node "...\CopyToCgiBaerDb\" on the
    dev PC corresponds to [forest]/srv/www/cgi-bin/BAERTOOLS/baer-db/ on the
    server.  The dev PC node "...\CopyToHtdocsBaerDb\" corresponds to the server
    node [forest]/srv/www/htdocs/BAERTOOLS/baer-db/.


.Server_Files
=============

These are the relevant files on our "forest" Web server:

/srv/www/
    cgi-bin/BEARTOOLS/baer-db/
        *.pl (currently just index.pl)
        TheProjs.sto
        TreatmentCategories.sto
    htdocs/BEARTOOLS/baer-db/
        baer-db.css
        Projects.xml
        Treatment Costs.xml
        Treatments.xml
        2500-8/
            *.pdf

Descriptions follow:

/srv/www/cgi-bin/BEARTOOLS/baer-db/*.pl
    The Perl code files which generate our Web pages.  Copied from the dev PC;
    see .Dev_Files.

/srv/www/cgi-bin/BEARTOOLS/baer-db/TheProjs.sto
/srv/www/cgi-bin/BEARTOOLS/baer-db/TreatmentCategories.sto
    Our Web page code generates these files from the .xml files in
    /srv/www/htdocs/BEARTOOLS/baer-db/, and then uses these files instead of the
    .xml files because these .sto files load much faster.  You may delete these 
    files and then our Web page code will automatically recreate them.  Our Web
    page code detects when these .sto files are older than the .xml files and
    updates the .sto files automatically, but you may (rarely) want to delete
    the .sto files in order to force them to be updated, e.g. if the server's
    clock is out of sync with the development PC's clock such that the
    timestamps on the files can't trigger an update appropriately.

/srv/www/htdocs/BEARTOOLS/baer-db/baer-db.css
    Our stylesheet, used by our Web pages.  Copied from the dev PC; see
    .Dev_Files.

/srv/www/htdocs/BEARTOOLS/baer-db/Projects.xml
/srv/www/htdocs/BEARTOOLS/baer-db/Treatment Costs.xml
/srv/www/htdocs/BEARTOOLS/baer-db/Treatments.xml
    These files contain the data from the EBAER database which our Web pages
    present to the user.  See .Using_a_New_DB for how these files are created
    and deployed to the server.  Once on the server, these files are used by our
    Perl Web page code.

/srv/www/htdocs/BEARTOOLS/baer-db/2500-8/*.pdf
    A large collection of PDF files containing 2500-8 BAR reports.  Our Perl Web
    page code offers these for downloading to the user.  See .BAR_Files for how
    these files are created and deployed.


.Using_a_New_DB
===============

About once a year, the EBAER mdb database will be updated and the new version
will need to be propagated into BWD.  Here are the steps:
*   Obtain the new Access DB file (e.g. from Pete) and copy it into
    [cma2]\CurrentEbaer\.
*   Open the Access file (the copy you made above) in MS Access.  Export the
    tables "Projects", "Treatment Costs", and "Treatments" as XML, to the files
    "Projects.xml", "Treatment Costs.xml", and "Treatments.xml", also in the
    folder [cma2]\CurrentEbaer\.  Export the data only, not the schemas nor the
    XSL.
*   Copy these XML table files (Projects.xml etc.) from the above location to
    [forest]/srv/www/htdocs/BAERTOOLS/baer-db/ on our Web server.  Our Web page
    code will then use them.
*   Our Perl Web page code (index.pl, see .Code) contains and uses a hard-coded
    copy of the RegionsForests table from the EBAER Access file.  So if this
    table is changed in the Access file (e.g. by adding a new forest), then the
    change must be propagated by hand into our Perl code.


.BAR_Files
==========

For most of the BAER projects in the database, our Web pages offer the
actual Burned Area Report (FS Form 2500-8) files for downloading.  Here is how
to make a new BAR file available on our Web site:
*   Rename the file to:
        2500-8_[fire name]_[forest name].pdf
    E.g. for the "Vallecito Fire" fire in the San Juan-Rio Grande NF, the proper
    file name is:
        2500-8_Vallecito Fire_San Juan-Rio Grande.pdf
    The fire name and forest name embedded in the filename must exactly match 
    the fire name and forest name in the EBAER database, as we display them on 
    our Web site, or else our Web page code can't find the file and offer it to
    the user.  Character casing must match the casing we display on the Web site
    (title case), *not* the original all-caps casing in the EBAER mdb. Spaces in
    the names must also be preserved.

    Exception:  A few fire names contain '/' (the slash character), which does
    not work in a filename, so you must substitute a single space for any '/'
    when you create the filename.

    Exception:  A few fire names contain the Unicode apostrophe (i.e., right-
    single-quote) character (code U+2019, hexadecimal).  You must substitute the
    plain ASCII non-directional single quote (the ' on your keyboard) for this 
    Unicode apostrophe when you create the filename.

    Exception:  A few fire names contain '?' (a question mark), which does not
    work in a filename.  You must delete all '?'s  when you create the filename.

    Note that the filename must end in .pdf and so of course the original
    2500-8 file must be first converted to PDF format if it's not already a PDF
    file.

    Note, some of the fire names in the DB end in the word "Fire", but most
    don't; your filename must match the fire name in the DB, either omitting or
    including the word "Fire".
*   Copy the renamed file into
    [cma2]\OutputsToForestWww\htdocs\BAERTOOLS\baer-db\2500-8\.  (This step is
    not strictly necessary but is for consistency since we store all of our
    "output target" files here before uploading them.)
*   Also upload the renamed file to the server in
    [forest]/srv/www/htdocs/BAERTOOLS/baer-db/2500-8/.  Once uploaded, our Web
    page code can find it and offer it to the user.


.Code
=====

Our Web page(s) are generated on the fly by our Perl CGI script(s) in
[cma2]\[ToBackup]\[BaerWebDb]\CopyToCgiBaerDb\ on the dev PC.  To modify our Web
pages, you modify these scripts and copy them to
[forest]/srv/www/cgi-bin/BAERTOOLS/baer-db/ on our Web server.

 A CSS stylesheet used by our Web pages, baer-db.css, is kept in
[cma2]\[ToBackup]\[BaerWebDb]\CopyToHtdocsBaerDb\ on the dev PC.  You deploy it
by copying it to [forest]/srv/www/htdocs/BAERTOOLS/baer-db/ on our Web server.

=================================== THE END ===================================

Updates

2015-03-12

Current server directories are
    /var/www/BAERTOOLS/baer-db
    /var/www/cgi-bin/BAERTOOLS/baer-db
